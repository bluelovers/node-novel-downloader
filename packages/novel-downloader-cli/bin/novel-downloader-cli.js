#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const __1 = require("..");
const yargs = require("yargs");
const path = require("path");
const novel_downloader_1 = require("novel-downloader");
const log_1 = require("../lib/log");
const update_notifier_1 = require("@yarn-tool/update-notifier");
let cli = yargs
    .option('outputDir', {
    alias: ['o'],
    requiresArg: true,
    normalize: true,
    desc: `用來儲存下載的內容的主資料夾`,
    type: "string",
    default: process.cwd(),
})
    .option('siteID', {
    desc: `網站模組名稱`,
    alias: ['s'],
    requiresArg: true,
    type: "string",
})
    .option('disableTxtdownload', {
    desc: `此選項目前僅適用於 Syosetu 小說家網站`,
    type: "boolean",
    default: true,
})
    .option('disableDownload', {
    desc: `不下載小說內容僅生成檔案結構`,
    type: "boolean",
})
    .option('noFirePrefix', {
    desc: `不生成檔名前綴`,
    type: "boolean",
})
    .option('noFilePadend', {
    desc: `不生成檔名後綴(例如時間日期那些，可用來保持檔案只有一個版本)，當使用此選項後，即使網站上有編輯過的新版依然不會去下載，如果要強制下載則請額外加上 --disableCheckExists`,
    type: "boolean",
    default: true,
})
    .option('filePrefixMode', {
    desc: `更改檔名前綴風格 0 | 1 | 2 | 3 | 4 | 5`,
    type: "number",
    default: 1,
})
    .option('pathNovelStyle', {
    desc: `小說目錄樣式 0 = 預設 , 1 = 小說 ID`,
    type: "number",
})
    .option('crlf', {
    desc: `使用 crlf 作為 換行`,
    type: 'boolean',
})
    .option('debug', {
    desc: `debug 模式用來顯示額外訊息 或者 提示目前執行的進度`,
    type: 'boolean',
    default: true,
})
    .option('fetchMetaDataOnly', {
    desc: `只抓取小說的 META 資料`,
    type: 'boolean',
})
    .option('disableCheckExists', {
    desc: `不檢查章節是否已經下載過`,
    type: 'boolean',
})
    .option('startIndex', {
    type: "number",
    default: 1,
})
    .option('keepRuby', {
    desc: `保留 Ruby 注音語法`,
    type: 'boolean',
    default: true,
})
    .option('keepFormat', {
    desc: `保留其他格式語法`,
    type: 'boolean',
})
    .option('keepImage', {
    desc: `在內文原始位置上保留圖片`,
    type: 'boolean',
    default: true,
})
    .option('protocolMode', {
    desc: `強制使用 http = 2 / https = 1 (僅限支援的模組)`,
})
    .command('list', '顯示出目前的模組名稱', function (args) {
    log_1.default.log(Object.keys(novel_downloader_1.EnumNovelSiteList).filter(v => /^[a-z]/i.test(v)));
    process.exit();
    return args;
})
    .argv;
let url = cli._[0];
update_notifier_1.updateNotifier([__dirname, '..']);
if (!url) {
    yargs.showHelp();
}
else {
    let downloadOptions = {};
    let siteOptions = {};
    ({ downloadOptions, siteOptions } = fixOptions(cli, downloadOptions, siteOptions));
    log_1.default.dir({
        cli,
        downloadOptions,
        siteOptions,
    });
    __1.download(url, downloadOptions, cli.siteID, siteOptions)
        .tap(function (novel) {
        log_1.default.success(novel.novel_title);
    })
        .tapCatch(function () {
        yargs.showHelp();
    });
}
function fixOptions(cli, downloadOptions, siteOptions) {
    if (cli.outputDir) {
        let s1 = path.normalize(cli.outputDir);
        [
            __dirname,
            path.join(__dirname, '..'),
        ].some(function (v) {
            let s2 = path.normalize(v);
            if (s1 == s2) {
                cli.outputDir = path.join(__dirname, '..', 'test/temp');
                return true;
            }
        });
    }
    // @ts-ignore
    downloadOptions.disableTxtdownload = cli.disableTxtdownload;
    downloadOptions.disableDownload = cli.disableDownload;
    downloadOptions.noFilePadend = cli.noFilePadend;
    downloadOptions.noFirePrefix = cli.noFirePrefix;
    downloadOptions.filePrefixMode = cli.filePrefixMode;
    downloadOptions.startIndex = cli.startIndex;
    downloadOptions.pathNovelStyle = cli.pathNovelStyle;
    downloadOptions.disableCheckExists = cli.disableCheckExists;
    downloadOptions.fetchMetaDataOnly = cli.fetchMetaDataOnly;
    downloadOptions.lineBreakCrlf = cli.crlf;
    downloadOptions.debugLog = cli.debug;
    downloadOptions.keepFormat = cli.keepFormat;
    downloadOptions.keepRuby = cli.keepRuby;
    downloadOptions.keepImage = cli.keepImage;
    // @ts-ignore
    downloadOptions.protocolMode = cli.protocolMode;
    siteOptions.outputDir = cli.outputDir;
    return { cli, downloadOptions, siteOptions };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm92ZWwtZG93bmxvYWRlci1jbGkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJub3ZlbC1kb3dubG9hZGVyLWNsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSwwQkFBOEI7QUFDOUIsK0JBQWdDO0FBQ2hDLDZCQUE4QjtBQUU5Qix1REFBc0Y7QUFDdEYsb0NBQWlDO0FBRWpDLGdFQUE0RDtBQU81RCxJQUFJLEdBQUcsR0FBRyxLQUFLO0tBQ2IsTUFBTSxDQUFDLFdBQVcsRUFBRTtJQUNwQixLQUFLLEVBQUUsQ0FBQyxHQUFHLENBQUM7SUFDWixXQUFXLEVBQUUsSUFBSTtJQUNqQixTQUFTLEVBQUUsSUFBSTtJQUNmLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsSUFBSSxFQUFFLFFBQVE7SUFDZCxPQUFPLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRTtDQUN0QixDQUFDO0tBQ0QsTUFBTSxDQUFDLFFBQVEsRUFBRTtJQUNqQixJQUFJLEVBQUUsUUFBUTtJQUNkLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQztJQUNaLFdBQVcsRUFBRSxJQUFJO0lBQ2pCLElBQUksRUFBRSxRQUFRO0NBQ2QsQ0FBQztLQUNELE1BQU0sQ0FBQyxvQkFBb0IsRUFBRTtJQUM3QixJQUFJLEVBQUUseUJBQXlCO0lBQy9CLElBQUksRUFBRSxTQUFTO0lBQ2YsT0FBTyxFQUFFLElBQUk7Q0FDYixDQUFDO0tBQ0QsTUFBTSxDQUFDLGlCQUFpQixFQUFFO0lBQzFCLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsSUFBSSxFQUFFLFNBQVM7Q0FDZixDQUFDO0tBQ0QsTUFBTSxDQUFDLGNBQWMsRUFBRTtJQUN2QixJQUFJLEVBQUUsU0FBUztJQUNmLElBQUksRUFBRSxTQUFTO0NBQ2YsQ0FBQztLQUNELE1BQU0sQ0FBQyxjQUFjLEVBQUU7SUFDdkIsSUFBSSxFQUFFLGdHQUFnRztJQUN0RyxJQUFJLEVBQUUsU0FBUztJQUNmLE9BQU8sRUFBRSxJQUFJO0NBQ2IsQ0FBQztLQUNELE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRTtJQUN6QixJQUFJLEVBQUUsZ0NBQWdDO0lBQ3RDLElBQUksRUFBRSxRQUFRO0lBQ2QsT0FBTyxFQUFFLENBQUM7Q0FDVixDQUFDO0tBQ0QsTUFBTSxDQUFDLGdCQUFnQixFQUFFO0lBQ3pCLElBQUksRUFBRSwyQkFBMkI7SUFDakMsSUFBSSxFQUFFLFFBQVE7Q0FDZCxDQUFDO0tBQ0QsTUFBTSxDQUFDLE1BQU0sRUFBRTtJQUNmLElBQUksRUFBRSxlQUFlO0lBQ3JCLElBQUksRUFBRSxTQUFTO0NBQ2YsQ0FBQztLQUNELE1BQU0sQ0FBQyxPQUFPLEVBQUU7SUFDaEIsSUFBSSxFQUFFLCtCQUErQjtJQUNyQyxJQUFJLEVBQUUsU0FBUztJQUNmLE9BQU8sRUFBRSxJQUFJO0NBQ2IsQ0FBQztLQUNELE1BQU0sQ0FBQyxtQkFBbUIsRUFBRTtJQUM1QixJQUFJLEVBQUUsZ0JBQWdCO0lBQ3RCLElBQUksRUFBRSxTQUFTO0NBQ2YsQ0FBQztLQUNELE1BQU0sQ0FBQyxvQkFBb0IsRUFBRTtJQUM3QixJQUFJLEVBQUUsY0FBYztJQUNwQixJQUFJLEVBQUUsU0FBUztDQUNmLENBQUM7S0FDRCxNQUFNLENBQUMsWUFBWSxFQUFFO0lBQ3JCLElBQUksRUFBRSxRQUFRO0lBQ2QsT0FBTyxFQUFFLENBQUM7Q0FDVixDQUFDO0tBQ0QsTUFBTSxDQUFDLFVBQVUsRUFBRTtJQUNuQixJQUFJLEVBQUUsY0FBYztJQUNwQixJQUFJLEVBQUUsU0FBUztJQUNmLE9BQU8sRUFBRSxJQUFJO0NBQ2IsQ0FBQztLQUNELE1BQU0sQ0FBQyxZQUFZLEVBQUU7SUFDckIsSUFBSSxFQUFFLFVBQVU7SUFDaEIsSUFBSSxFQUFFLFNBQVM7Q0FDZixDQUFDO0tBQ0QsTUFBTSxDQUFDLFdBQVcsRUFBRTtJQUNwQixJQUFJLEVBQUUsY0FBYztJQUNwQixJQUFJLEVBQUUsU0FBUztJQUNmLE9BQU8sRUFBRSxJQUFJO0NBQ2IsQ0FBQztLQUNELE1BQU0sQ0FBQyxjQUFjLEVBQUU7SUFDdkIsSUFBSSxFQUFFLHFDQUFxQztDQUMzQyxDQUFDO0tBQ0QsT0FBTyxDQUFDLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxJQUFJO0lBRTVDLGFBQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxvQ0FBaUIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTNFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUVmLE9BQU8sSUFBSSxDQUFBO0FBQ1osQ0FBQyxDQUFDO0tBQ0QsSUFBMkIsQ0FDNUI7QUFXRCxJQUFJLEdBQUcsR0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRTNCLGdDQUFjLENBQUMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUVsQyxJQUFJLENBQUMsR0FBRyxFQUNSO0lBQ0MsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO0NBQ2pCO0tBRUQ7SUFDQyxJQUFJLGVBQWUsR0FBK0IsRUFBRSxDQUFDO0lBQ3JELElBQUksV0FBVyxHQUF1QixFQUFFLENBQUM7SUFFekMsQ0FBQyxFQUFFLGVBQWUsRUFBRSxXQUFXLEVBQUUsR0FBRyxVQUFVLENBQUMsR0FBRyxFQUFFLGVBQWUsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBRW5GLGFBQU8sQ0FBQyxHQUFHLENBQUM7UUFDWCxHQUFHO1FBQ0gsZUFBZTtRQUNmLFdBQVc7S0FDWCxDQUFDLENBQUM7SUFFSCxZQUFRLENBQUMsR0FBRyxFQUFFLGVBQWUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQztTQUNyRCxHQUFHLENBQUMsVUFBVSxLQUFLO1FBRW5CLGFBQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztTQUNELFFBQVEsQ0FBQztRQUVULEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQixDQUFDLENBQUMsQ0FDRjtDQUNEO0FBRUQsU0FBUyxVQUFVLENBQUMsR0FBd0IsRUFBRSxlQUEyQyxFQUFFLFdBQStCO0lBRXpILElBQUksR0FBRyxDQUFDLFNBQVMsRUFDakI7UUFDQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUV2QztZQUNDLFNBQW1CO1lBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQztTQUMxQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7WUFFakIsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQixJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQ1o7Z0JBQ0MsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUM7Z0JBQ3hELE9BQU8sSUFBSSxDQUFDO2FBQ1o7UUFDRixDQUFDLENBQUMsQ0FBQTtLQUNGO0lBRUQsYUFBYTtJQUNiLGVBQWUsQ0FBQyxrQkFBa0IsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUM7SUFDNUQsZUFBZSxDQUFDLGVBQWUsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDO0lBQ3RELGVBQWUsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQztJQUNoRCxlQUFlLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxZQUFZLENBQUM7SUFDaEQsZUFBZSxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsY0FBYyxDQUFDO0lBQ3BELGVBQWUsQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQztJQUM1QyxlQUFlLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxjQUFjLENBQUM7SUFDcEQsZUFBZSxDQUFDLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQztJQUM1RCxlQUFlLENBQUMsaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGlCQUFpQixDQUFDO0lBRTFELGVBQWUsQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN6QyxlQUFlLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7SUFFckMsZUFBZSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDO0lBQzVDLGVBQWUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztJQUN4QyxlQUFlLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFFMUMsYUFBYTtJQUNiLGVBQWUsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQztJQUVoRCxXQUFXLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFFdEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxlQUFlLEVBQUUsV0FBVyxFQUFFLENBQUM7QUFDOUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcblxuaW1wb3J0IHsgZG93bmxvYWQgfSBmcm9tICcuLic7XG5pbXBvcnQgeWFyZ3MgPSByZXF1aXJlKFwieWFyZ3NcIik7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuaW1wb3J0IHsgQXJndW1lbnRzIH0gZnJvbSAneWFyZ3MnO1xuaW1wb3J0IHJlcXVpcmVOb3ZlbFNpdGVDbGFzcywgeyBFbnVtTm92ZWxTaXRlTGlzdCwgTm92ZWxTaXRlIH0gZnJvbSBcIm5vdmVsLWRvd25sb2FkZXJcIlxuaW1wb3J0IGNvbnNvbGUgZnJvbSAnLi4vbGliL2xvZyc7XG5pbXBvcnQgUEFDS0FHRV9KU09OID0gcmVxdWlyZSgnLi4vcGFja2FnZS5qc29uJyk7XG5pbXBvcnQgeyB1cGRhdGVOb3RpZmllciB9IGZyb20gJ0B5YXJuLXRvb2wvdXBkYXRlLW5vdGlmaWVyJztcbmltcG9ydCB7IEVudW1QYXRoTm92ZWxTdHlsZSB9IGZyb20gJ25vdmVsLWRvd25sb2FkZXIvc3JjL3NpdGUvaW5kZXgnO1xuaW1wb3J0IHsgaXNOcHggfSBmcm9tICdAeWFybi10b29sL2lzLW5weCc7XG5pbXBvcnQgeyBJVFNQYXJ0aWFsUGljayB9IGZyb20gJ3RzLXR5cGUnO1xuaW1wb3J0IE5vdmVsU2l0ZVN5b3NldHUsIHsgSU9wdGlvbnNQbHVzIGFzIElPcHRpb25zUGx1c05vdmVsU2l0ZVN5b3NldHUgfSBmcm9tICdub3ZlbC1kb3dubG9hZGVyL3NyYy9zaXRlL3N5b3NldHUvaW5kZXgnO1xuXG5cbmxldCBjbGkgPSB5YXJnc1xuXHQub3B0aW9uKCdvdXRwdXREaXInLCB7XG5cdFx0YWxpYXM6IFsnbyddLFxuXHRcdHJlcXVpcmVzQXJnOiB0cnVlLFxuXHRcdG5vcm1hbGl6ZTogdHJ1ZSxcblx0XHRkZXNjOiBg55So5L6G5YSy5a2Y5LiL6LyJ55qE5YWn5a6555qE5Li76LOH5paZ5aS+YCxcblx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdGRlZmF1bHQ6IHByb2Nlc3MuY3dkKCksXG5cdH0pXG5cdC5vcHRpb24oJ3NpdGVJRCcsIHtcblx0XHRkZXNjOiBg57ay56uZ5qih57WE5ZCN56ixYCxcblx0XHRhbGlhczogWydzJ10sXG5cdFx0cmVxdWlyZXNBcmc6IHRydWUsXG5cdFx0dHlwZTogXCJzdHJpbmdcIixcblx0fSlcblx0Lm9wdGlvbignZGlzYWJsZVR4dGRvd25sb2FkJywge1xuXHRcdGRlc2M6IGDmraTpgbjpoIXnm67liY3lg4XpgannlKjmlrwgU3lvc2V0dSDlsI/oqqrlrrbntrLnq5lgLFxuXHRcdHR5cGU6IFwiYm9vbGVhblwiLFxuXHRcdGRlZmF1bHQ6IHRydWUsXG5cdH0pXG5cdC5vcHRpb24oJ2Rpc2FibGVEb3dubG9hZCcsIHtcblx0XHRkZXNjOiBg5LiN5LiL6LyJ5bCP6Kqq5YWn5a655YOF55Sf5oiQ5qqU5qGI57WQ5qeLYCxcblx0XHR0eXBlOiBcImJvb2xlYW5cIixcblx0fSlcblx0Lm9wdGlvbignbm9GaXJlUHJlZml4Jywge1xuXHRcdGRlc2M6IGDkuI3nlJ/miJDmqpTlkI3liY3ntrRgLFxuXHRcdHR5cGU6IFwiYm9vbGVhblwiLFxuXHR9KVxuXHQub3B0aW9uKCdub0ZpbGVQYWRlbmQnLCB7XG5cdFx0ZGVzYzogYOS4jeeUn+aIkOaqlOWQjeW+jOe2tCjkvovlpoLmmYLplpPml6XmnJ/pgqPkupvvvIzlj6/nlKjkvobkv53mjIHmqpTmoYjlj6rmnInkuIDlgIvniYjmnKwp77yM55W25L2/55So5q2k6YG46aCF5b6M77yM5Y2z5L2/57ay56uZ5LiK5pyJ57eo6Lyv6YGO55qE5paw54mI5L6d54S25LiN5pyD5Y675LiL6LyJ77yM5aaC5p6c6KaB5by35Yi25LiL6LyJ5YmH6KuL6aGN5aSW5Yqg5LiKIC0tZGlzYWJsZUNoZWNrRXhpc3RzYCxcblx0XHR0eXBlOiBcImJvb2xlYW5cIixcblx0XHRkZWZhdWx0OiB0cnVlLFxuXHR9KVxuXHQub3B0aW9uKCdmaWxlUHJlZml4TW9kZScsIHtcblx0XHRkZXNjOiBg5pu05pS55qqU5ZCN5YmN57a06aKo5qC8IDAgfCAxIHwgMiB8IDMgfCA0IHwgNWAsXG5cdFx0dHlwZTogXCJudW1iZXJcIixcblx0XHRkZWZhdWx0OiAxLFxuXHR9KVxuXHQub3B0aW9uKCdwYXRoTm92ZWxTdHlsZScsIHtcblx0XHRkZXNjOiBg5bCP6Kqq55uu6YyE5qij5byPIDAgPSDpoJDoqK0gLCAxID0g5bCP6KqqIElEYCxcblx0XHR0eXBlOiBcIm51bWJlclwiLFxuXHR9KVxuXHQub3B0aW9uKCdjcmxmJywge1xuXHRcdGRlc2M6IGDkvb/nlKggY3JsZiDkvZzngrog5o+b6KGMYCxcblx0XHR0eXBlOiAnYm9vbGVhbicsXG5cdH0pXG5cdC5vcHRpb24oJ2RlYnVnJywge1xuXHRcdGRlc2M6IGBkZWJ1ZyDmqKHlvI/nlKjkvobpoa/npLrpoY3lpJboqIrmga8g5oiW6ICFIOaPkOekuuebruWJjeWft+ihjOeahOmAsuW6pmAsXG5cdFx0dHlwZTogJ2Jvb2xlYW4nLFxuXHRcdGRlZmF1bHQ6IHRydWUsXG5cdH0pXG5cdC5vcHRpb24oJ2ZldGNoTWV0YURhdGFPbmx5Jywge1xuXHRcdGRlc2M6IGDlj6rmipPlj5blsI/oqqrnmoQgTUVUQSDos4fmlplgLFxuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0fSlcblx0Lm9wdGlvbignZGlzYWJsZUNoZWNrRXhpc3RzJywge1xuXHRcdGRlc2M6IGDkuI3mqqLmn6Xnq6Dnr4DmmK/lkKblt7LntpPkuIvovInpgY5gLFxuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0fSlcblx0Lm9wdGlvbignc3RhcnRJbmRleCcsIHtcblx0XHR0eXBlOiBcIm51bWJlclwiLFxuXHRcdGRlZmF1bHQ6IDEsXG5cdH0pXG5cdC5vcHRpb24oJ2tlZXBSdWJ5Jywge1xuXHRcdGRlc2M6IGDkv53nlZkgUnVieSDms6jpn7Poqp7ms5VgLFxuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0XHRkZWZhdWx0OiB0cnVlLFxuXHR9KVxuXHQub3B0aW9uKCdrZWVwRm9ybWF0Jywge1xuXHRcdGRlc2M6IGDkv53nlZnlhbbku5bmoLzlvI/oqp7ms5VgLFxuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0fSlcblx0Lm9wdGlvbigna2VlcEltYWdlJywge1xuXHRcdGRlc2M6IGDlnKjlhafmlofljp/lp4vkvY3nva7kuIrkv53nlZnlnJbniYdgLFxuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0XHRkZWZhdWx0OiB0cnVlLFxuXHR9KVxuXHQub3B0aW9uKCdwcm90b2NvbE1vZGUnLCB7XG5cdFx0ZGVzYzogYOW8t+WItuS9v+eUqCBodHRwID0gMiAvIGh0dHBzID0gMSAo5YOF6ZmQ5pSv5o+055qE5qih57WEKWAsXG5cdH0pXG5cdC5jb21tYW5kKCdsaXN0JywgJ+mhr+ekuuWHuuebruWJjeeahOaooee1hOWQjeeosScsIGZ1bmN0aW9uIChhcmdzKVxuXHR7XG5cdFx0Y29uc29sZS5sb2coT2JqZWN0LmtleXMoRW51bU5vdmVsU2l0ZUxpc3QpLmZpbHRlcih2ID0+IC9eW2Etel0vaS50ZXN0KHYpKSk7XG5cblx0XHRwcm9jZXNzLmV4aXQoKTtcblxuXHRcdHJldHVybiBhcmdzXG5cdH0pXG5cdC5hcmd2IGFzIEFyZ3VtZW50czxJQ2xpQXJndj5cbjtcblxuaW50ZXJmYWNlIElDbGlBcmd2IGV4dGVuZHMgSVRTUGFydGlhbFBpY2s8SU9wdGlvbnNQbHVzTm92ZWxTaXRlU3lvc2V0dSwgJ2Rpc2FibGVUeHRkb3dubG9hZCcgfCAncHJvdG9jb2xNb2RlJz4sIElUU1BhcnRpYWxQaWNrPE5vdmVsU2l0ZS5JRG93bmxvYWRPcHRpb25zLCAnZGlzYWJsZURvd25sb2FkJyB8ICdub0ZpcmVQcmVmaXgnIHwgJ25vRmlsZVBhZGVuZCcgfCAnZmlsZVByZWZpeE1vZGUnIHwgJ3N0YXJ0SW5kZXgnIHwgJ3BhdGhOb3ZlbFN0eWxlJyB8ICdkaXNhYmxlQ2hlY2tFeGlzdHMnIHwgJ2ZldGNoTWV0YURhdGFPbmx5JyB8ICdrZWVwUnVieScgfCAna2VlcEZvcm1hdCcgfCAna2VlcEltYWdlJz4sIElUU1BhcnRpYWxQaWNrPE5vdmVsU2l0ZS5JT3B0aW9ucywgJ291dHB1dERpcic+XG57XG5cdHNpdGVJRD86IEVudW1Ob3ZlbFNpdGVMaXN0LFxuXG5cdGNybGY/OiBib29sZWFuLFxuXG5cdGRlYnVnPzogYm9vbGVhbixcbn1cblxubGV0IHVybDogc3RyaW5nID0gY2xpLl9bMF07XG5cbnVwZGF0ZU5vdGlmaWVyKFtfX2Rpcm5hbWUsICcuLiddKTtcblxuaWYgKCF1cmwpXG57XG5cdHlhcmdzLnNob3dIZWxwKCk7XG59XG5lbHNlXG57XG5cdGxldCBkb3dubG9hZE9wdGlvbnM6IE5vdmVsU2l0ZS5JRG93bmxvYWRPcHRpb25zID0ge307XG5cdGxldCBzaXRlT3B0aW9uczogTm92ZWxTaXRlLklPcHRpb25zID0ge307XG5cblx0KHsgZG93bmxvYWRPcHRpb25zLCBzaXRlT3B0aW9ucyB9ID0gZml4T3B0aW9ucyhjbGksIGRvd25sb2FkT3B0aW9ucywgc2l0ZU9wdGlvbnMpKTtcblxuXHRjb25zb2xlLmRpcih7XG5cdFx0Y2xpLFxuXHRcdGRvd25sb2FkT3B0aW9ucyxcblx0XHRzaXRlT3B0aW9ucyxcblx0fSk7XG5cblx0ZG93bmxvYWQodXJsLCBkb3dubG9hZE9wdGlvbnMsIGNsaS5zaXRlSUQsIHNpdGVPcHRpb25zKVxuXHRcdC50YXAoZnVuY3Rpb24gKG5vdmVsKVxuXHRcdHtcblx0XHRcdGNvbnNvbGUuc3VjY2Vzcyhub3ZlbC5ub3ZlbF90aXRsZSk7XG5cdFx0fSlcblx0XHQudGFwQ2F0Y2goZnVuY3Rpb24gKClcblx0XHR7XG5cdFx0XHR5YXJncy5zaG93SGVscCgpO1xuXHRcdH0pXG5cdDtcbn1cblxuZnVuY3Rpb24gZml4T3B0aW9ucyhjbGk6IEFyZ3VtZW50czxJQ2xpQXJndj4sIGRvd25sb2FkT3B0aW9uczogTm92ZWxTaXRlLklEb3dubG9hZE9wdGlvbnMsIHNpdGVPcHRpb25zOiBOb3ZlbFNpdGUuSU9wdGlvbnMpXG57XG5cdGlmIChjbGkub3V0cHV0RGlyKVxuXHR7XG5cdFx0bGV0IHMxID0gcGF0aC5ub3JtYWxpemUoY2xpLm91dHB1dERpcik7XG5cblx0XHRbXG5cdFx0XHRfX2Rpcm5hbWUgYXMgc3RyaW5nLFxuXHRcdFx0cGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJyksXG5cdFx0XS5zb21lKGZ1bmN0aW9uICh2KVxuXHRcdHtcblx0XHRcdGxldCBzMiA9IHBhdGgubm9ybWFsaXplKHYpO1xuXHRcdFx0aWYgKHMxID09IHMyKVxuXHRcdFx0e1xuXHRcdFx0XHRjbGkub3V0cHV0RGlyID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ3Rlc3QvdGVtcCcpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHR9KVxuXHR9XG5cblx0Ly8gQHRzLWlnbm9yZVxuXHRkb3dubG9hZE9wdGlvbnMuZGlzYWJsZVR4dGRvd25sb2FkID0gY2xpLmRpc2FibGVUeHRkb3dubG9hZDtcblx0ZG93bmxvYWRPcHRpb25zLmRpc2FibGVEb3dubG9hZCA9IGNsaS5kaXNhYmxlRG93bmxvYWQ7XG5cdGRvd25sb2FkT3B0aW9ucy5ub0ZpbGVQYWRlbmQgPSBjbGkubm9GaWxlUGFkZW5kO1xuXHRkb3dubG9hZE9wdGlvbnMubm9GaXJlUHJlZml4ID0gY2xpLm5vRmlyZVByZWZpeDtcblx0ZG93bmxvYWRPcHRpb25zLmZpbGVQcmVmaXhNb2RlID0gY2xpLmZpbGVQcmVmaXhNb2RlO1xuXHRkb3dubG9hZE9wdGlvbnMuc3RhcnRJbmRleCA9IGNsaS5zdGFydEluZGV4O1xuXHRkb3dubG9hZE9wdGlvbnMucGF0aE5vdmVsU3R5bGUgPSBjbGkucGF0aE5vdmVsU3R5bGU7XG5cdGRvd25sb2FkT3B0aW9ucy5kaXNhYmxlQ2hlY2tFeGlzdHMgPSBjbGkuZGlzYWJsZUNoZWNrRXhpc3RzO1xuXHRkb3dubG9hZE9wdGlvbnMuZmV0Y2hNZXRhRGF0YU9ubHkgPSBjbGkuZmV0Y2hNZXRhRGF0YU9ubHk7XG5cblx0ZG93bmxvYWRPcHRpb25zLmxpbmVCcmVha0NybGYgPSBjbGkuY3JsZjtcblx0ZG93bmxvYWRPcHRpb25zLmRlYnVnTG9nID0gY2xpLmRlYnVnO1xuXG5cdGRvd25sb2FkT3B0aW9ucy5rZWVwRm9ybWF0ID0gY2xpLmtlZXBGb3JtYXQ7XG5cdGRvd25sb2FkT3B0aW9ucy5rZWVwUnVieSA9IGNsaS5rZWVwUnVieTtcblx0ZG93bmxvYWRPcHRpb25zLmtlZXBJbWFnZSA9IGNsaS5rZWVwSW1hZ2U7XG5cblx0Ly8gQHRzLWlnbm9yZVxuXHRkb3dubG9hZE9wdGlvbnMucHJvdG9jb2xNb2RlID0gY2xpLnByb3RvY29sTW9kZTtcblxuXHRzaXRlT3B0aW9ucy5vdXRwdXREaXIgPSBjbGkub3V0cHV0RGlyO1xuXG5cdHJldHVybiB7IGNsaSwgZG93bmxvYWRPcHRpb25zLCBzaXRlT3B0aW9ucyB9O1xufVxuIl19