#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const __1 = require("..");
const yargs = require("yargs");
const path = require("path");
const novel_downloader_1 = require("novel-downloader");
const log_1 = require("../lib/log");
const PACKAGE_JSON = require("../package.json");
const updateNotifier = require("update-notifier");
const is_npx_1 = require("@yarn-tool/is-npx");
let cli = yargs
    .option('outputDir', {
    alias: ['o'],
    requiresArg: true,
    normalize: true,
    desc: `用來儲存下載的內容的主資料夾`,
    type: "string",
    default: process.cwd(),
})
    .option('siteID', {
    desc: `網站模組名稱`,
    alias: ['s'],
    requiresArg: true,
    type: "string",
})
    .option('disableTxtdownload', {
    desc: `此選項目前僅適用於 Syosetu 小說家網站`,
    type: "boolean",
    default: true,
})
    .option('disableDownload', {
    desc: `不下載小說內容僅生成檔案結構`,
    type: "boolean",
})
    .option('noFirePrefix', {
    desc: `不生成檔名前綴`,
    type: "boolean",
})
    .option('noFilePadend', {
    desc: `不生成檔名後綴(例如時間日期那些，可用來保持檔案只有一個版本)，當使用此選項後，即使網站上有編輯過的新版依然不會去下載，如果要強制下載則請額外加上 --disableCheckExists`,
    type: "boolean",
    default: true,
})
    .option('filePrefixMode', {
    desc: `更改檔名前綴風格 0 | 1 | 2 | 3 | 4 | 5`,
    type: "number",
    default: 1,
})
    .option('pathNovelStyle', {
    desc: `小說目錄樣式 0 = 預設 , 1 = 小說 ID`,
    type: "number",
})
    .option('crlf', {
    desc: `使用 crlf 作為 換行`,
    type: 'boolean',
})
    .option('debug', {
    desc: `debug 模式用來顯示額外訊息 或者 提示目前執行的進度`,
    type: 'boolean',
    default: true,
})
    .option('fetchMetaDataOnly', {
    desc: `只抓取小說的 META 資料`,
    type: 'boolean',
})
    .option('disableCheckExists', {
    desc: `不檢查章節是否已經下載過`,
    type: 'boolean',
})
    .option('startIndex', {
    type: "number",
    default: 1,
})
    .option('keepRuby', {
    desc: `保留 Ruby 注音語法`,
    type: 'boolean',
    default: true,
})
    .option('keepFormat', {
    desc: `保留其他格式語法`,
    type: 'boolean',
})
    .option('keepImage', {
    desc: `在內文原始位置上保留圖片`,
    type: 'boolean',
    default: true,
})
    .option('protocolMode', {
    desc: `強制使用 http = 2 / https = 1 (僅限支援的模組)`,
})
    .command('list', '顯示出目前的模組名稱', function (args) {
    log_1.default.log(Object.keys(novel_downloader_1.EnumNovelSiteList).filter(v => /^[a-z]/i.test(v)));
    process.exit();
    return args;
})
    .argv;
let url = cli._[0];
if (!is_npx_1.isNpx({
    __dirname
})) {
    checkUpdateSelf().notify();
}
if (!url) {
    yargs.showHelp();
}
else {
    let downloadOptions = {};
    let siteOptions = {};
    ({ downloadOptions, siteOptions } = fixOptions(cli, downloadOptions, siteOptions));
    log_1.default.dir({
        cli,
        downloadOptions,
        siteOptions,
    });
    __1.download(url, downloadOptions, cli.siteID, siteOptions)
        .tap(function (novel) {
        log_1.default.success(novel.novel_title);
    })
        .tapCatch(function () {
        yargs.showHelp();
    });
}
function fixOptions(cli, downloadOptions, siteOptions) {
    if (cli.outputDir) {
        let s1 = path.normalize(cli.outputDir);
        [
            __dirname,
            path.join(__dirname, '..'),
        ].some(function (v) {
            let s2 = path.normalize(v);
            if (s1 == s2) {
                cli.outputDir = path.join(__dirname, '..', 'test/temp');
                return true;
            }
        });
    }
    // @ts-ignore
    downloadOptions.disableTxtdownload = cli.disableTxtdownload;
    downloadOptions.disableDownload = cli.disableDownload;
    downloadOptions.noFilePadend = cli.noFilePadend;
    downloadOptions.noFirePrefix = cli.noFirePrefix;
    downloadOptions.filePrefixMode = cli.filePrefixMode;
    downloadOptions.startIndex = cli.startIndex;
    downloadOptions.pathNovelStyle = cli.pathNovelStyle;
    downloadOptions.disableCheckExists = cli.disableCheckExists;
    downloadOptions.fetchMetaDataOnly = cli.fetchMetaDataOnly;
    downloadOptions.lineBreakCrlf = cli.crlf;
    downloadOptions.debugLog = cli.debug;
    downloadOptions.keepFormat = cli.keepFormat;
    downloadOptions.keepRuby = cli.keepRuby;
    downloadOptions.keepImage = cli.keepImage;
    // @ts-ignore
    downloadOptions.protocolMode = cli.protocolMode;
    siteOptions.outputDir = cli.outputDir;
    return { cli, downloadOptions, siteOptions };
}
function checkUpdateSelf() {
    let data = updateNotifier({
        pkg: PACKAGE_JSON,
    });
    return data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm92ZWwtZG93bmxvYWRlci1jbGkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJub3ZlbC1kb3dubG9hZGVyLWNsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSwwQkFBOEI7QUFDOUIsK0JBQWdDO0FBQ2hDLDZCQUE4QjtBQUU5Qix1REFBc0Y7QUFDdEYsb0NBQWlDO0FBQ2pDLGdEQUFpRDtBQUNqRCxrREFBbUQ7QUFFbkQsOENBQTBDO0FBSzFDLElBQUksR0FBRyxHQUFHLEtBQUs7S0FDYixNQUFNLENBQUMsV0FBVyxFQUFFO0lBQ3BCLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQztJQUNaLFdBQVcsRUFBRSxJQUFJO0lBQ2pCLFNBQVMsRUFBRSxJQUFJO0lBQ2YsSUFBSSxFQUFFLGdCQUFnQjtJQUN0QixJQUFJLEVBQUUsUUFBUTtJQUNkLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFO0NBQ3RCLENBQUM7S0FDRCxNQUFNLENBQUMsUUFBUSxFQUFFO0lBQ2pCLElBQUksRUFBRSxRQUFRO0lBQ2QsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDO0lBQ1osV0FBVyxFQUFFLElBQUk7SUFDakIsSUFBSSxFQUFFLFFBQVE7Q0FDZCxDQUFDO0tBQ0QsTUFBTSxDQUFDLG9CQUFvQixFQUFFO0lBQzdCLElBQUksRUFBRSx5QkFBeUI7SUFDL0IsSUFBSSxFQUFFLFNBQVM7SUFDZixPQUFPLEVBQUUsSUFBSTtDQUNiLENBQUM7S0FDRCxNQUFNLENBQUMsaUJBQWlCLEVBQUU7SUFDMUIsSUFBSSxFQUFFLGdCQUFnQjtJQUN0QixJQUFJLEVBQUUsU0FBUztDQUNmLENBQUM7S0FDRCxNQUFNLENBQUMsY0FBYyxFQUFFO0lBQ3ZCLElBQUksRUFBRSxTQUFTO0lBQ2YsSUFBSSxFQUFFLFNBQVM7Q0FDZixDQUFDO0tBQ0QsTUFBTSxDQUFDLGNBQWMsRUFBRTtJQUN2QixJQUFJLEVBQUUsZ0dBQWdHO0lBQ3RHLElBQUksRUFBRSxTQUFTO0lBQ2Ys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QUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDO0lBQzVELGVBQWUsQ0FBQyxpQkFBaUIsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUM7SUFFMUQsZUFBZSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO0lBQ3pDLGVBQWUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztJQUVyQyxlQUFlLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUM7SUFDNUMsZUFBZSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDO0lBQ3hDLGVBQWUsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztJQUUxQyxhQUFhO0lBQ2IsZUFBZSxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDO0lBRWhELFdBQVcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztJQUV0QyxPQUFPLEVBQUUsR0FBRyxFQUFFLGVBQWUsRUFBRSxXQUFXLEVBQUUsQ0FBQztBQUM5QyxDQUFDO0FBRUQsU0FBUyxlQUFlO0lBRXZCLElBQUksSUFBSSxHQUFHLGNBQWMsQ0FBQztRQUN6QixHQUFHLEVBQUUsWUFBWTtLQUNqQixDQUFDLENBQUM7SUFFSCxPQUFPLElBQUksQ0FBQztBQUNiLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5cbmltcG9ydCB7IGRvd25sb2FkIH0gZnJvbSAnLi4nO1xuaW1wb3J0IHlhcmdzID0gcmVxdWlyZShcInlhcmdzXCIpO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbmltcG9ydCB7IEFyZ3VtZW50cyB9IGZyb20gJ3lhcmdzJztcbmltcG9ydCByZXF1aXJlTm92ZWxTaXRlQ2xhc3MsIHsgRW51bU5vdmVsU2l0ZUxpc3QsIE5vdmVsU2l0ZSB9IGZyb20gXCJub3ZlbC1kb3dubG9hZGVyXCJcbmltcG9ydCBjb25zb2xlIGZyb20gJy4uL2xpYi9sb2cnO1xuaW1wb3J0IFBBQ0tBR0VfSlNPTiA9IHJlcXVpcmUoJy4uL3BhY2thZ2UuanNvbicpO1xuaW1wb3J0IHVwZGF0ZU5vdGlmaWVyID0gcmVxdWlyZSgndXBkYXRlLW5vdGlmaWVyJyk7XG5pbXBvcnQgeyBFbnVtUGF0aE5vdmVsU3R5bGUgfSBmcm9tICdub3ZlbC1kb3dubG9hZGVyL3NyYy9zaXRlL2luZGV4JztcbmltcG9ydCB7IGlzTnB4IH0gZnJvbSAnQHlhcm4tdG9vbC9pcy1ucHgnO1xuaW1wb3J0IHsgSVRTUGFydGlhbFBpY2sgfSBmcm9tICd0cy10eXBlJztcbmltcG9ydCBOb3ZlbFNpdGVTeW9zZXR1LCB7IElPcHRpb25zUGx1cyBhcyBJT3B0aW9uc1BsdXNOb3ZlbFNpdGVTeW9zZXR1IH0gZnJvbSAnbm92ZWwtZG93bmxvYWRlci9zcmMvc2l0ZS9zeW9zZXR1L2luZGV4JztcblxuXG5sZXQgY2xpID0geWFyZ3Ncblx0Lm9wdGlvbignb3V0cHV0RGlyJywge1xuXHRcdGFsaWFzOiBbJ28nXSxcblx0XHRyZXF1aXJlc0FyZzogdHJ1ZSxcblx0XHRub3JtYWxpemU6IHRydWUsXG5cdFx0ZGVzYzogYOeUqOS+huWEsuWtmOS4i+i8ieeahOWFp+WuueeahOS4u+izh+aWmeWkvmAsXG5cdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRkZWZhdWx0OiBwcm9jZXNzLmN3ZCgpLFxuXHR9KVxuXHQub3B0aW9uKCdzaXRlSUQnLCB7XG5cdFx0ZGVzYzogYOe2suermeaooee1hOWQjeeosWAsXG5cdFx0YWxpYXM6IFsncyddLFxuXHRcdHJlcXVpcmVzQXJnOiB0cnVlLFxuXHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdH0pXG5cdC5vcHRpb24oJ2Rpc2FibGVUeHRkb3dubG9hZCcsIHtcblx0XHRkZXNjOiBg5q2k6YG46aCF55uu5YmN5YOF6YGp55So5pa8IFN5b3NldHUg5bCP6Kqq5a6257ay56uZYCxcblx0XHR0eXBlOiBcImJvb2xlYW5cIixcblx0XHRkZWZhdWx0OiB0cnVlLFxuXHR9KVxuXHQub3B0aW9uKCdkaXNhYmxlRG93bmxvYWQnLCB7XG5cdFx0ZGVzYzogYOS4jeS4i+i8ieWwj+iqquWFp+WuueWDheeUn+aIkOaqlOahiOe1kOani2AsXG5cdFx0dHlwZTogXCJib29sZWFuXCIsXG5cdH0pXG5cdC5vcHRpb24oJ25vRmlyZVByZWZpeCcsIHtcblx0XHRkZXNjOiBg5LiN55Sf5oiQ5qqU5ZCN5YmN57a0YCxcblx0XHR0eXBlOiBcImJvb2xlYW5cIixcblx0fSlcblx0Lm9wdGlvbignbm9GaWxlUGFkZW5kJywge1xuXHRcdGRlc2M6IGDkuI3nlJ/miJDmqpTlkI3lvozntrQo5L6L5aaC5pmC6ZaT5pel5pyf6YKj5Lqb77yM5Y+v55So5L6G5L+d5oyB5qqU5qGI5Y+q5pyJ5LiA5YCL54mI5pysKe+8jOeVtuS9v+eUqOatpOmBuOmgheW+jO+8jOWNs+S9v+e2suermeS4iuaciee3qOi8r+mBjueahOaWsOeJiOS+neeEtuS4jeacg+WOu+S4i+i8ie+8jOWmguaenOimgeW8t+WItuS4i+i8ieWJh+iri+mhjeWkluWKoOS4iiAtLWRpc2FibGVDaGVja0V4aXN0c2AsXG5cdFx0dHlwZTogXCJib29sZWFuXCIsXG5cdFx0ZGVmYXVsdDogdHJ1ZSxcblx0fSlcblx0Lm9wdGlvbignZmlsZVByZWZpeE1vZGUnLCB7XG5cdFx0ZGVzYzogYOabtOaUueaqlOWQjeWJjee2tOmiqOagvCAwIHwgMSB8IDIgfCAzIHwgNCB8IDVgLFxuXHRcdHR5cGU6IFwibnVtYmVyXCIsXG5cdFx0ZGVmYXVsdDogMSxcblx0fSlcblx0Lm9wdGlvbigncGF0aE5vdmVsU3R5bGUnLCB7XG5cdFx0ZGVzYzogYOWwj+iqquebrumMhOaoo+W8jyAwID0g6aCQ6KitICwgMSA9IOWwj+iqqiBJRGAsXG5cdFx0dHlwZTogXCJudW1iZXJcIixcblx0fSlcblx0Lm9wdGlvbignY3JsZicsIHtcblx0XHRkZXNjOiBg5L2/55SoIGNybGYg5L2c54K6IOaPm+ihjGAsXG5cdFx0dHlwZTogJ2Jvb2xlYW4nLFxuXHR9KVxuXHQub3B0aW9uKCdkZWJ1ZycsIHtcblx0XHRkZXNjOiBgZGVidWcg5qih5byP55So5L6G6aGv56S66aGN5aSW6KiK5oGvIOaIluiAhSDmj5DnpLrnm67liY3ln7fooYznmoTpgLLluqZgLFxuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0XHRkZWZhdWx0OiB0cnVlLFxuXHR9KVxuXHQub3B0aW9uKCdmZXRjaE1ldGFEYXRhT25seScsIHtcblx0XHRkZXNjOiBg5Y+q5oqT5Y+W5bCP6Kqq55qEIE1FVEEg6LOH5paZYCxcblx0XHR0eXBlOiAnYm9vbGVhbicsXG5cdH0pXG5cdC5vcHRpb24oJ2Rpc2FibGVDaGVja0V4aXN0cycsIHtcblx0XHRkZXNjOiBg5LiN5qqi5p+l56ug56+A5piv5ZCm5bey57aT5LiL6LyJ6YGOYCxcblx0XHR0eXBlOiAnYm9vbGVhbicsXG5cdH0pXG5cdC5vcHRpb24oJ3N0YXJ0SW5kZXgnLCB7XG5cdFx0dHlwZTogXCJudW1iZXJcIixcblx0XHRkZWZhdWx0OiAxLFxuXHR9KVxuXHQub3B0aW9uKCdrZWVwUnVieScsIHtcblx0XHRkZXNjOiBg5L+d55WZIFJ1Ynkg5rOo6Z+z6Kqe5rOVYCxcblx0XHR0eXBlOiAnYm9vbGVhbicsXG5cdFx0ZGVmYXVsdDogdHJ1ZSxcblx0fSlcblx0Lm9wdGlvbigna2VlcEZvcm1hdCcsIHtcblx0XHRkZXNjOiBg5L+d55WZ5YW25LuW5qC85byP6Kqe5rOVYCxcblx0XHR0eXBlOiAnYm9vbGVhbicsXG5cdH0pXG5cdC5vcHRpb24oJ2tlZXBJbWFnZScsIHtcblx0XHRkZXNjOiBg5Zyo5YWn5paH5Y6f5aeL5L2N572u5LiK5L+d55WZ5ZyW54mHYCxcblx0XHR0eXBlOiAnYm9vbGVhbicsXG5cdFx0ZGVmYXVsdDogdHJ1ZSxcblx0fSlcblx0Lm9wdGlvbigncHJvdG9jb2xNb2RlJywge1xuXHRcdGRlc2M6IGDlvLfliLbkvb/nlKggaHR0cCA9IDIgLyBodHRwcyA9IDEgKOWDhemZkOaUr+aPtOeahOaooee1hClgLFxuXHR9KVxuXHQuY29tbWFuZCgnbGlzdCcsICfpoa/npLrlh7rnm67liY3nmoTmqKHntYTlkI3nqLEnLCBmdW5jdGlvbiAoYXJncylcblx0e1xuXHRcdGNvbnNvbGUubG9nKE9iamVjdC5rZXlzKEVudW1Ob3ZlbFNpdGVMaXN0KS5maWx0ZXIodiA9PiAvXlthLXpdL2kudGVzdCh2KSkpO1xuXG5cdFx0cHJvY2Vzcy5leGl0KCk7XG5cblx0XHRyZXR1cm4gYXJnc1xuXHR9KVxuXHQuYXJndiBhcyBBcmd1bWVudHM8SUNsaUFyZ3Y+XG47XG5cbmludGVyZmFjZSBJQ2xpQXJndiBleHRlbmRzIElUU1BhcnRpYWxQaWNrPElPcHRpb25zUGx1c05vdmVsU2l0ZVN5b3NldHUsICdkaXNhYmxlVHh0ZG93bmxvYWQnIHwgJ3Byb3RvY29sTW9kZSc+LCBJVFNQYXJ0aWFsUGljazxOb3ZlbFNpdGUuSURvd25sb2FkT3B0aW9ucywgJ2Rpc2FibGVEb3dubG9hZCcgfCAnbm9GaXJlUHJlZml4JyB8ICdub0ZpbGVQYWRlbmQnIHwgJ2ZpbGVQcmVmaXhNb2RlJyB8ICdzdGFydEluZGV4JyB8ICdwYXRoTm92ZWxTdHlsZScgfCAnZGlzYWJsZUNoZWNrRXhpc3RzJyB8ICdmZXRjaE1ldGFEYXRhT25seScgfCAna2VlcFJ1YnknIHwgJ2tlZXBGb3JtYXQnIHwgJ2tlZXBJbWFnZSc+LCBJVFNQYXJ0aWFsUGljazxOb3ZlbFNpdGUuSU9wdGlvbnMsICdvdXRwdXREaXInPlxue1xuXHRzaXRlSUQ/OiBFbnVtTm92ZWxTaXRlTGlzdCxcblxuXHRjcmxmPzogYm9vbGVhbixcblxuXHRkZWJ1Zz86IGJvb2xlYW4sXG59XG5cbmxldCB1cmw6IHN0cmluZyA9IGNsaS5fWzBdO1xuXG5pZiAoIWlzTnB4KHtcblx0X19kaXJuYW1lXG59KSlcbntcblx0Y2hlY2tVcGRhdGVTZWxmKCkubm90aWZ5KCk7XG59XG5cbmlmICghdXJsKVxue1xuXHR5YXJncy5zaG93SGVscCgpO1xufVxuZWxzZVxue1xuXHRsZXQgZG93bmxvYWRPcHRpb25zOiBOb3ZlbFNpdGUuSURvd25sb2FkT3B0aW9ucyA9IHt9O1xuXHRsZXQgc2l0ZU9wdGlvbnM6IE5vdmVsU2l0ZS5JT3B0aW9ucyA9IHt9O1xuXG5cdCh7IGRvd25sb2FkT3B0aW9ucywgc2l0ZU9wdGlvbnMgfSA9IGZpeE9wdGlvbnMoY2xpLCBkb3dubG9hZE9wdGlvbnMsIHNpdGVPcHRpb25zKSk7XG5cblx0Y29uc29sZS5kaXIoe1xuXHRcdGNsaSxcblx0XHRkb3dubG9hZE9wdGlvbnMsXG5cdFx0c2l0ZU9wdGlvbnMsXG5cdH0pO1xuXG5cdGRvd25sb2FkKHVybCwgZG93bmxvYWRPcHRpb25zLCBjbGkuc2l0ZUlELCBzaXRlT3B0aW9ucylcblx0XHQudGFwKGZ1bmN0aW9uIChub3ZlbClcblx0XHR7XG5cdFx0XHRjb25zb2xlLnN1Y2Nlc3Mobm92ZWwubm92ZWxfdGl0bGUpO1xuXHRcdH0pXG5cdFx0LnRhcENhdGNoKGZ1bmN0aW9uICgpXG5cdFx0e1xuXHRcdFx0eWFyZ3Muc2hvd0hlbHAoKTtcblx0XHR9KVxuXHQ7XG59XG5cbmZ1bmN0aW9uIGZpeE9wdGlvbnMoY2xpOiBBcmd1bWVudHM8SUNsaUFyZ3Y+LCBkb3dubG9hZE9wdGlvbnM6IE5vdmVsU2l0ZS5JRG93bmxvYWRPcHRpb25zLCBzaXRlT3B0aW9uczogTm92ZWxTaXRlLklPcHRpb25zKVxue1xuXHRpZiAoY2xpLm91dHB1dERpcilcblx0e1xuXHRcdGxldCBzMSA9IHBhdGgubm9ybWFsaXplKGNsaS5vdXRwdXREaXIpO1xuXG5cdFx0W1xuXHRcdFx0X19kaXJuYW1lIGFzIHN0cmluZyxcblx0XHRcdHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicpLFxuXHRcdF0uc29tZShmdW5jdGlvbiAodilcblx0XHR7XG5cdFx0XHRsZXQgczIgPSBwYXRoLm5vcm1hbGl6ZSh2KTtcblx0XHRcdGlmIChzMSA9PSBzMilcblx0XHRcdHtcblx0XHRcdFx0Y2xpLm91dHB1dERpciA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICd0ZXN0L3RlbXAnKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0fSlcblx0fVxuXG5cdC8vIEB0cy1pZ25vcmVcblx0ZG93bmxvYWRPcHRpb25zLmRpc2FibGVUeHRkb3dubG9hZCA9IGNsaS5kaXNhYmxlVHh0ZG93bmxvYWQ7XG5cdGRvd25sb2FkT3B0aW9ucy5kaXNhYmxlRG93bmxvYWQgPSBjbGkuZGlzYWJsZURvd25sb2FkO1xuXHRkb3dubG9hZE9wdGlvbnMubm9GaWxlUGFkZW5kID0gY2xpLm5vRmlsZVBhZGVuZDtcblx0ZG93bmxvYWRPcHRpb25zLm5vRmlyZVByZWZpeCA9IGNsaS5ub0ZpcmVQcmVmaXg7XG5cdGRvd25sb2FkT3B0aW9ucy5maWxlUHJlZml4TW9kZSA9IGNsaS5maWxlUHJlZml4TW9kZTtcblx0ZG93bmxvYWRPcHRpb25zLnN0YXJ0SW5kZXggPSBjbGkuc3RhcnRJbmRleDtcblx0ZG93bmxvYWRPcHRpb25zLnBhdGhOb3ZlbFN0eWxlID0gY2xpLnBhdGhOb3ZlbFN0eWxlO1xuXHRkb3dubG9hZE9wdGlvbnMuZGlzYWJsZUNoZWNrRXhpc3RzID0gY2xpLmRpc2FibGVDaGVja0V4aXN0cztcblx0ZG93bmxvYWRPcHRpb25zLmZldGNoTWV0YURhdGFPbmx5ID0gY2xpLmZldGNoTWV0YURhdGFPbmx5O1xuXG5cdGRvd25sb2FkT3B0aW9ucy5saW5lQnJlYWtDcmxmID0gY2xpLmNybGY7XG5cdGRvd25sb2FkT3B0aW9ucy5kZWJ1Z0xvZyA9IGNsaS5kZWJ1ZztcblxuXHRkb3dubG9hZE9wdGlvbnMua2VlcEZvcm1hdCA9IGNsaS5rZWVwRm9ybWF0O1xuXHRkb3dubG9hZE9wdGlvbnMua2VlcFJ1YnkgPSBjbGkua2VlcFJ1Ynk7XG5cdGRvd25sb2FkT3B0aW9ucy5rZWVwSW1hZ2UgPSBjbGkua2VlcEltYWdlO1xuXG5cdC8vIEB0cy1pZ25vcmVcblx0ZG93bmxvYWRPcHRpb25zLnByb3RvY29sTW9kZSA9IGNsaS5wcm90b2NvbE1vZGU7XG5cblx0c2l0ZU9wdGlvbnMub3V0cHV0RGlyID0gY2xpLm91dHB1dERpcjtcblxuXHRyZXR1cm4geyBjbGksIGRvd25sb2FkT3B0aW9ucywgc2l0ZU9wdGlvbnMgfTtcbn1cblxuZnVuY3Rpb24gY2hlY2tVcGRhdGVTZWxmKClcbntcblx0bGV0IGRhdGEgPSB1cGRhdGVOb3RpZmllcih7XG5cdFx0cGtnOiBQQUNLQUdFX0pTT04sXG5cdH0pO1xuXG5cdHJldHVybiBkYXRhO1xufVxuIl19