"use strict";
/**
 * Created by user on 2019/1/3/003.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const fg = require("@bluelovers/fast-glob");
const path = require("path");
const fs = require("fs-extra");
const Bluebird = require("bluebird");
const array_hyper_unique_1 = require("array-hyper-unique");
fg.async([
    '*/**.ts',
], {
    cwd: path.join(__dirname, '..', 'src/site'),
    ignore: [
        '**/*.d.ts',
    ],
})
    .then(function (ls) {
    //console.log(ls);
    return ls.sort().reduce(function (a, b) {
        b = b.replace(/\.ts$/, '');
        let basename = path.basename(b);
        let ds = b.split('/');
        let id;
        if (basename == 'index') {
            ds.pop();
        }
        let b2 = ds.join('/');
        ds = ds.map(function (s) {
            return s.replace(/^[a-z]/, function (s) {
                return s.toUpperCase();
            });
        });
        id = [
            'NovelSite',
        ].concat(ds).join('');
        a.push([id, b2]);
        return a;
    }, []);
})
    .then(async (ls) => {
    //console.log(ls);
    ls = await Bluebird.resolve(ls)
        .filter(async ([k, v]) => {
        let m = await Promise.resolve().then(() => require(`../src/site/${v}`)).then(m => m.default)
            .catch(e => null);
        return typeof m === 'function' && m.prototype;
    });
    let ret = [''];
    let s;
    s = `export enum EnumNovelSiteList
{
	${ls.map(([k, v]) => `${k} = '${v}',`).join('\n\t')}
	${ls.map(([k, v]) => `'${v}' = '${v}',`).join('\n\t')}
	${ls.map(([k, v]) => `'./site/${v}' = '${v}',`).join('\n\t')}
}`;
    ret.push(s);
    s = `export type EnumNovelSiteListString = '${array_hyper_unique_1.array_unique(ls.map(([k, v]) => v)).join('\' | \'')}';`;
    ret.push(s);
    s = ``;
    let ls2 = await Bluebird.resolve(ls)
        .reduce(async (a, [k, v]) => {
        let IDKEY = await Promise.resolve().then(() => require(`../src/site/${v}`)).then(m => m.default.IDKEY)
            .catch(e => null);
        if (IDKEY) {
            a.push([k, v, IDKEY]);
        }
        return a;
    }, []);
    await Bluebird.resolve(ls2)
        .reduce(async (a, [k, v, IDKEY]) => {
        a[0].push(`${k} = '${IDKEY}',`);
        a[1].push(`'${v}' = '${IDKEY}',`);
        a[1].push(`'${IDKEY}' = '${IDKEY}',`);
        a[2].push(`'./site/${v}' = '${IDKEY}',`);
        a[3].push(IDKEY);
        if (v !== 'dmzj') {
            a[4][v] = IDKEY;
        }
        return a;
    }, [[], [], [], [], {}])
        .then(a => {
        array_hyper_unique_1.array_unique_overwrite(a[0]);
        array_hyper_unique_1.array_unique_overwrite(a[1]);
        array_hyper_unique_1.array_unique_overwrite(a[2]);
        let s = `export enum EnumIDKEYList
{
	${a[0].join('\n\t')}
	${a[1].join('\n\t')}
	${a[2].join('\n\t')}
}`;
        ret.push(s);
        s = `export type EnumIDKEYListString = '${array_hyper_unique_1.array_unique(a[3]).join('\' | \'')}';`;
        ret.push(s);
        let o = Object.entries(a[4])
            .map(([siteID, IDKEY]) => {
            return `'${IDKEY}' = '${siteID}',`;
        });
        s = `export enum EnumIDKEYToSiteID
{
	${o.join('\n\t')}
}`;
        ret.push(s);
    });
    s = `export interface INovelSiteList
{
	${ls.map(([k, v]) => `${k}: typeof import('../site/${v}').default`).join('\n\t')}
}`;
    ret.push(s);
    await fs.writeFile(path.join(__dirname, '..', 'src/all/const.ts'), ret.join('\n\n'));
    ret = [];
    s = `import _NovelSite from './site';\nimport Bluebird = require("bluebird");`;
    ret.push(s);
    ret.push(`import { EnumNovelSiteList, INovelSiteList } from './all/const';`);
    ret.push(`export { EnumNovelSiteList, INovelSiteList }`);
    s = ls.map(([k, v]) => `export function requireNovelSiteClass(siteID: EnumNovelSiteList.${k} | '${v}'): INovelSiteList["${k}"]\n`).join('');
    s += `export function requireNovelSiteClass\<T extends typeof _NovelSite\>(siteID: EnumNovelSiteList | string): T
export function requireNovelSiteClass(siteID: EnumNovelSiteList | string)
{
	if (!(siteID in EnumNovelSiteList))
	{
		throw new RangeError(\`'\${siteID}' not exists\`);
	}
	return require(\`./site/\$\{EnumNovelSiteList[siteID]\}\`).default
}`;
    ret.push(s);
    s = `export default requireNovelSiteClass`;
    ret.push(s);
    ret.push('');
    return fs.writeFile(path.join(__dirname, '..', 'src/all.ts'), ret.join('\n\n'));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLXNpdGUtbGlzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNyZWF0ZS1zaXRlLWxpc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILDRDQUE2QztBQUM3Qyw2QkFBOEI7QUFDOUIsK0JBQWdDO0FBQ2hDLHFDQUFzQztBQUN0QywyREFBMEU7QUFFMUUsRUFBRSxDQUFDLEtBQUssQ0FBUztJQUNoQixTQUFTO0NBQ1QsRUFBRTtJQUNGLEdBQUcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsVUFBVSxDQUFDO0lBQzNDLE1BQU0sRUFBRTtRQUNQLFdBQVc7S0FDWDtDQUNELENBQUM7S0FDQSxJQUFJLENBQUMsVUFBVSxFQUFFO0lBRWpCLGtCQUFrQjtJQUVsQixPQUFPLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztRQUVyQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFM0IsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXRCLElBQUksRUFBVSxDQUFDO1FBRWYsSUFBSSxRQUFRLElBQUksT0FBTyxFQUN2QjtZQUNDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUNUO1FBRUQsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV0QixFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7WUFFdEIsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUM7Z0JBRXJDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lB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QUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFFckYsR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUVULENBQUMsR0FBRywwRUFBMEUsQ0FBQztJQUUvRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRVosR0FBRyxDQUFDLElBQUksQ0FBQyxrRUFBa0UsQ0FBQyxDQUFDO0lBQzdFLEdBQUcsQ0FBQyxJQUFJLENBQUMsOENBQThDLENBQUMsQ0FBQztJQUV6RCxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxtRUFBbUUsQ0FBQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRTVJLENBQUMsSUFBSTs7Ozs7Ozs7RUFRTCxDQUFDO0lBRUQsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVaLENBQUMsR0FBRyxzQ0FBc0MsQ0FBQztJQUUzQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRVosR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUViLE9BQU8sRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsWUFBWSxDQUFDLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQ2pGLENBQUMsQ0FBQyxDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOS8xLzMvMDAzLlxuICovXG5cbmltcG9ydCBmZyA9IHJlcXVpcmUoXCJAYmx1ZWxvdmVycy9mYXN0LWdsb2JcIik7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuaW1wb3J0IGZzID0gcmVxdWlyZShcImZzLWV4dHJhXCIpO1xuaW1wb3J0IEJsdWViaXJkID0gcmVxdWlyZShcImJsdWViaXJkXCIpO1xuaW1wb3J0IHsgYXJyYXlfdW5pcXVlX292ZXJ3cml0ZSwgYXJyYXlfdW5pcXVlIH0gZnJvbSAnYXJyYXktaHlwZXItdW5pcXVlJztcblxuZmcuYXN5bmM8c3RyaW5nPihbXG5cdCcqLyoqLnRzJyxcbl0sIHtcblx0Y3dkOiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnc3JjL3NpdGUnKSxcblx0aWdub3JlOiBbXG5cdFx0JyoqLyouZC50cycsXG5cdF0sXG59KVxuXHQudGhlbihmdW5jdGlvbiAobHMpXG5cdHtcblx0XHQvL2NvbnNvbGUubG9nKGxzKTtcblxuXHRcdHJldHVybiBscy5zb3J0KCkucmVkdWNlKGZ1bmN0aW9uIChhLCBiKVxuXHRcdHtcblx0XHRcdGIgPSBiLnJlcGxhY2UoL1xcLnRzJC8sICcnKTtcblxuXHRcdFx0bGV0IGJhc2VuYW1lID0gcGF0aC5iYXNlbmFtZShiKTtcblx0XHRcdGxldCBkcyA9IGIuc3BsaXQoJy8nKTtcblxuXHRcdFx0bGV0IGlkOiBzdHJpbmc7XG5cblx0XHRcdGlmIChiYXNlbmFtZSA9PSAnaW5kZXgnKVxuXHRcdFx0e1xuXHRcdFx0XHRkcy5wb3AoKTtcblx0XHRcdH1cblxuXHRcdFx0bGV0IGIyID0gZHMuam9pbignLycpO1xuXG5cdFx0XHRkcyA9IGRzLm1hcChmdW5jdGlvbiAocylcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIHMucmVwbGFjZSgvXlthLXpdLywgZnVuY3Rpb24gKHMpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyZXR1cm4gcy50b1VwcGVyQ2FzZSgpO1xuXHRcdFx0XHR9KVxuXHRcdFx0fSk7XG5cblx0XHRcdGlkID0gW1xuXHRcdFx0XHQnTm92ZWxTaXRlJyxcblx0XHRcdF0uY29uY2F0KGRzKS5qb2luKCcnKTtcblxuXHRcdFx0YS5wdXNoKFtpZCwgYjJdKTtcblxuXHRcdFx0cmV0dXJuIGE7XG5cdFx0fSwgW10pXG5cdH0pXG5cdC50aGVuKGFzeW5jIChscykgPT4ge1xuXHRcdC8vY29uc29sZS5sb2cobHMpO1xuXG5cdFx0bHMgPSBhd2FpdCBCbHVlYmlyZC5yZXNvbHZlKGxzKVxuXHRcdFx0LmZpbHRlcihhc3luYyAoW2ssIHZdKSA9PlxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgbSA9IGF3YWl0IGltcG9ydChgLi4vc3JjL3NpdGUvJHt2fWApXG5cdFx0XHRcdFx0LnRoZW4obSA9PiBtLmRlZmF1bHQpXG5cdFx0XHRcdFx0LmNhdGNoKGUgPT4gbnVsbClcblx0XHRcdFx0O1xuXG5cdFx0XHRcdHJldHVybiB0eXBlb2YgbSA9PT0gJ2Z1bmN0aW9uJyAmJiBtLnByb3RvdHlwZVxuXHRcdFx0fSlcblx0XHQ7XG5cblx0XHRsZXQgcmV0OiBzdHJpbmdbXSA9IFsnJ107XG5cblx0XHRsZXQgczogc3RyaW5nO1xuXG5cdFx0cyA9IGBleHBvcnQgZW51bSBFbnVtTm92ZWxTaXRlTGlzdFxue1xuXHQke2xzLm1hcCgoW2ssIHZdKSA9PiBgJHtrfSA9ICcke3Z9JyxgKS5qb2luKCdcXG5cXHQnKX1cblx0JHtscy5tYXAoKFtrLCB2XSkgPT4gYCcke3Z9JyA9ICcke3Z9JyxgKS5qb2luKCdcXG5cXHQnKX1cblx0JHtscy5tYXAoKFtrLCB2XSkgPT4gYCcuL3NpdGUvJHt2fScgPSAnJHt2fScsYCkuam9pbignXFxuXFx0Jyl9XG59YDtcblxuXHRcdHJldC5wdXNoKHMpO1xuXG5cdFx0cyA9IGBleHBvcnQgdHlwZSBFbnVtTm92ZWxTaXRlTGlzdFN0cmluZyA9ICcke2FycmF5X3VuaXF1ZShscy5tYXAoKFtrLCB2XSkgPT4gdikpLmpvaW4oJ1xcJyB8IFxcJycpfSc7YDtcblxuXHRcdHJldC5wdXNoKHMpO1xuXG5cdFx0cyA9IGBgO1xuXG5cdFx0bGV0IGxzMiA9IGF3YWl0IEJsdWViaXJkLnJlc29sdmUobHMpXG5cdFx0XHQucmVkdWNlKGFzeW5jIChhLCBbaywgdl0pID0+XG5cdFx0XHR7XG5cblx0XHRcdFx0bGV0IElES0VZID0gYXdhaXQgaW1wb3J0KGAuLi9zcmMvc2l0ZS8ke3Z9YClcblx0XHRcdFx0XHQudGhlbihtID0+IG0uZGVmYXVsdC5JREtFWSlcblx0XHRcdFx0XHQuY2F0Y2goZSA9PiBudWxsKVxuXHRcdFx0XHQ7XG5cblx0XHRcdFx0aWYgKElES0VZKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0YS5wdXNoKFtrLCB2LCBJREtFWV0pXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gYVxuXHRcdFx0fSwgW10gYXMgW3N0cmluZywgc3RyaW5nLCBzdHJpbmddW10pXG5cdFx0O1xuXG5cdFx0YXdhaXQgQmx1ZWJpcmQucmVzb2x2ZShsczIpXG5cdFx0XHQucmVkdWNlKGFzeW5jIChhLCBbaywgdiwgSURLRVldKSA9PiB7XG5cblx0XHRcdFx0YVswXS5wdXNoKGAke2t9ID0gJyR7SURLRVl9JyxgKTtcblx0XHRcdFx0YVsxXS5wdXNoKGAnJHt2fScgPSAnJHtJREtFWX0nLGApO1xuXHRcdFx0XHRhWzFdLnB1c2goYCcke0lES0VZfScgPSAnJHtJREtFWX0nLGApO1xuXHRcdFx0XHRhWzJdLnB1c2goYCcuL3NpdGUvJHt2fScgPSAnJHtJREtFWX0nLGApO1xuXG5cdFx0XHRcdGFbM10ucHVzaChJREtFWSk7XG5cblx0XHRcdFx0aWYgKHYgIT09ICdkbXpqJylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGFbNF1bdl0gPSBJREtFWTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBhXG5cdFx0XHR9LCBbW10sIFtdLCBbXSwgW10sIHt9XSBhcyBbc3RyaW5nW10sIHN0cmluZ1tdLCBzdHJpbmdbXSwgc3RyaW5nW10sIFJlY29yZDxzdHJpbmcsIHN0cmluZz5dKVxuXHRcdFx0LnRoZW4oYSA9PiB7XG5cblx0XHRcdFx0YXJyYXlfdW5pcXVlX292ZXJ3cml0ZShhWzBdKTtcblx0XHRcdFx0YXJyYXlfdW5pcXVlX292ZXJ3cml0ZShhWzFdKTtcblx0XHRcdFx0YXJyYXlfdW5pcXVlX292ZXJ3cml0ZShhWzJdKTtcblxuXHRcdFx0XHRsZXQgcyA9IGBleHBvcnQgZW51bSBFbnVtSURLRVlMaXN0XG57XG5cdCR7YVswXS5qb2luKCdcXG5cXHQnKX1cblx0JHthWzFdLmpvaW4oJ1xcblxcdCcpfVxuXHQke2FbMl0uam9pbignXFxuXFx0Jyl9XG59YDtcblxuXHRcdFx0XHRyZXQucHVzaChzKTtcblxuXHRcdFx0XHRzID0gYGV4cG9ydCB0eXBlIEVudW1JREtFWUxpc3RTdHJpbmcgPSAnJHthcnJheV91bmlxdWUoYVszXSkuam9pbignXFwnIHwgXFwnJyl9JztgO1xuXG5cdFx0XHRcdHJldC5wdXNoKHMpO1xuXG5cdFx0XHRcdGxldCBvID0gT2JqZWN0LmVudHJpZXMoYVs0XSlcblx0XHRcdFx0XHQubWFwKChbc2l0ZUlELCBJREtFWV0pID0+IHtcblx0XHRcdFx0XHRcdHJldHVybiBgJyR7SURLRVl9JyA9ICcke3NpdGVJRH0nLGBcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHQ7XG5cblx0XHRcdFx0cyA9IGBleHBvcnQgZW51bSBFbnVtSURLRVlUb1NpdGVJRFxue1xuXHQke28uam9pbignXFxuXFx0Jyl9XG59YDtcblxuXHRcdFx0XHRyZXQucHVzaChzKTtcblxuXHRcdFx0fSlcblx0XHQ7XG5cblx0XHRzID0gYGV4cG9ydCBpbnRlcmZhY2UgSU5vdmVsU2l0ZUxpc3Rcbntcblx0JHtscy5tYXAoKFtrLCB2XSkgPT4gYCR7a306IHR5cGVvZiBpbXBvcnQoJy4uL3NpdGUvJHt2fScpLmRlZmF1bHRgKS5qb2luKCdcXG5cXHQnKX1cbn1gO1xuXG5cdFx0cmV0LnB1c2gocyk7XG5cblx0XHRhd2FpdCBmcy53cml0ZUZpbGUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ3NyYy9hbGwvY29uc3QudHMnKSwgcmV0LmpvaW4oJ1xcblxcbicpKTtcblxuXHRcdHJldCA9IFtdO1xuXG5cdFx0cyA9IGBpbXBvcnQgX05vdmVsU2l0ZSBmcm9tICcuL3NpdGUnO1xcbmltcG9ydCBCbHVlYmlyZCA9IHJlcXVpcmUoXCJibHVlYmlyZFwiKTtgO1xuXG5cdFx0cmV0LnB1c2gocyk7XG5cblx0XHRyZXQucHVzaChgaW1wb3J0IHsgRW51bU5vdmVsU2l0ZUxpc3QsIElOb3ZlbFNpdGVMaXN0IH0gZnJvbSAnLi9hbGwvY29uc3QnO2ApO1xuXHRcdHJldC5wdXNoKGBleHBvcnQgeyBFbnVtTm92ZWxTaXRlTGlzdCwgSU5vdmVsU2l0ZUxpc3QgfWApO1xuXG5cdFx0cyA9IGxzLm1hcCgoW2ssIHZdKSA9PiBgZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVOb3ZlbFNpdGVDbGFzcyhzaXRlSUQ6IEVudW1Ob3ZlbFNpdGVMaXN0LiR7a30gfCAnJHt2fScpOiBJTm92ZWxTaXRlTGlzdFtcIiR7a31cIl1cXG5gKS5qb2luKCcnKTtcblxuXHRcdHMgKz0gYGV4cG9ydCBmdW5jdGlvbiByZXF1aXJlTm92ZWxTaXRlQ2xhc3NcXDxUIGV4dGVuZHMgdHlwZW9mIF9Ob3ZlbFNpdGVcXD4oc2l0ZUlEOiBFbnVtTm92ZWxTaXRlTGlzdCB8IHN0cmluZyk6IFRcbmV4cG9ydCBmdW5jdGlvbiByZXF1aXJlTm92ZWxTaXRlQ2xhc3Moc2l0ZUlEOiBFbnVtTm92ZWxTaXRlTGlzdCB8IHN0cmluZylcbntcblx0aWYgKCEoc2l0ZUlEIGluIEVudW1Ob3ZlbFNpdGVMaXN0KSlcblx0e1xuXHRcdHRocm93IG5ldyBSYW5nZUVycm9yKFxcYCdcXCR7c2l0ZUlEfScgbm90IGV4aXN0c1xcYCk7XG5cdH1cblx0cmV0dXJuIHJlcXVpcmUoXFxgLi9zaXRlL1xcJFxce0VudW1Ob3ZlbFNpdGVMaXN0W3NpdGVJRF1cXH1cXGApLmRlZmF1bHRcbn1gO1xuXG5cdFx0cmV0LnB1c2gocyk7XG5cblx0XHRzID0gYGV4cG9ydCBkZWZhdWx0IHJlcXVpcmVOb3ZlbFNpdGVDbGFzc2A7XG5cblx0XHRyZXQucHVzaChzKTtcblxuXHRcdHJldC5wdXNoKCcnKTtcblxuXHRcdHJldHVybiBmcy53cml0ZUZpbGUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ3NyYy9hbGwudHMnKSwgcmV0LmpvaW4oJ1xcblxcbicpKTtcblx0fSlcbjtcbiJdfQ==