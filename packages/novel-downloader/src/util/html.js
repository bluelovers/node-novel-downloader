"use strict";
/// <reference types="jquery" />
Object.defineProperty(exports, "__esModule", { value: true });
exports._tagToFormat = exports._keepImageInContext = exports.keepFormatTag = void 0;
const hash_1 = require("./hash");
function keepFormatTag(target, opts) {
    let { optionsRuntime, $ } = opts;
    let _target = $(target);
    if (optionsRuntime.keepRuby) {
        [
            'rp',
            'rt',
            'ruby',
        ].forEach(tag => {
            _tagToFormat(_target, tag, $);
        });
    }
    if (optionsRuntime.keepFormat) {
        [
            's',
            'i',
            'b',
            'sup',
            'sub',
        ].forEach(tag => {
            _tagToFormat(_target, tag, $);
        });
    }
    return _target;
}
exports.keepFormatTag = keepFormatTag;
function _keepImageInContext(_imgs, $, { prefix = '插圖', append = '', } = {}) {
    _imgs.each((i, elem) => {
        let img = $(elem);
        let src = img.prop('src');
        img.after(`（${prefix}${hash_1.hashSum(src)}）${append}`);
        img.remove();
    });
    return _imgs;
}
exports._keepImageInContext = _keepImageInContext;
function _tagToFormat(_target, tag, $) {
    _target.find(tag)
        .each((i, elem) => {
        let _this = $(elem);
        _this.after(`＜${tag}＞${_this.html()}＜/${tag}＞`);
        _this.remove();
    });
    return _target;
}
exports._tagToFormat = _tagToFormat;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHRtbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImh0bWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGdDQUFnQzs7O0FBR2hDLGlDQUFpQztBQUVqQyxTQUFnQixhQUFhLENBQTRFLE1BQVMsRUFBRSxJQUduSDtJQUVBLElBQUksRUFBRSxjQUFjLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDO0lBRWpDLElBQUksT0FBTyxHQUFXLENBQUMsQ0FBQyxNQUFxQixDQUFDLENBQUM7SUFFL0MsSUFBSSxjQUFjLENBQUMsUUFBUSxFQUMzQjtRQUNDO1lBQ0MsSUFBSTtZQUNKLElBQUk7WUFDSixNQUFNO1NBQ04sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFFZixZQUFZLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUM5QixDQUFDLENBQUMsQ0FDRDtLQUNEO0lBRUQsSUFBSSxjQUFjLENBQUMsVUFBVSxFQUM3QjtRQUNDO1lBQ0MsR0FBRztZQUNILEdBQUc7WUFDSCxHQUFHO1lBQ0gsS0FBSztZQUNMLEtBQUs7U0FDTCxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUVmLFlBQVksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzlCLENBQUMsQ0FBQyxDQUNEO0tBQ0Q7SUFFRCxPQUFPLE9BQU8sQ0FBQTtBQUNmLENBQUM7QUF0Q0Qsc0NBc0NDO0FBRUQsU0FBZ0IsbUJBQW1CLENBQUMsS0FBYSxFQUFFLENBQWUsRUFBRSxFQUNuRSxNQUFNLEdBQUcsSUFBSSxFQUNiLE1BQU0sR0FBRyxFQUFFLEdBQ1gsR0FBRyxFQUFFO0lBRUwsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUV0QixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEIsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUUxQixHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksTUFBTSxHQUFHLGNBQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUVkLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxLQUFLLENBQUM7QUFDZCxDQUFDO0FBaEJELGtEQWdCQztBQUVELFNBQWdCLFlBQVksQ0FBQyxPQUFlLEVBQUUsR0FBVyxFQUFFLENBQWU7SUFFekUsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7U0FDZixJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFFakIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXBCLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDaEQsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBRWhCLENBQUMsQ0FBQyxDQUNGO0lBRUQsT0FBTyxPQUFPLENBQUM7QUFDaEIsQ0FBQztBQWRELG9DQWNDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJqcXVlcnlcIiAvPlxuXG5pbXBvcnQgTm92ZWxTaXRlIGZyb20gJy4uL3NpdGUvaW5kZXgnO1xuaW1wb3J0IHsgaGFzaFN1bSB9IGZyb20gJy4vaGFzaCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBrZWVwRm9ybWF0VGFnPE8gPSBOb3ZlbFNpdGUuSU9wdGlvbnNSdW50aW1lLCBFIGV4dGVuZHMgdW5rbm93biB8IEpRdWVyeVN0YXRpYyA9IHVua25vd24+KHRhcmdldDogRSwgb3B0czoge1xuXHQkOiBKUXVlcnlTdGF0aWMsXG5cdG9wdGlvbnNSdW50aW1lOiBPICYgTm92ZWxTaXRlLklPcHRpb25zUnVudGltZSxcbn0pXG57XG5cdGxldCB7IG9wdGlvbnNSdW50aW1lLCAkIH0gPSBvcHRzO1xuXG5cdGxldCBfdGFyZ2V0OiBKUXVlcnkgPSAkKHRhcmdldCBhcyBIVE1MRWxlbWVudCk7XG5cblx0aWYgKG9wdGlvbnNSdW50aW1lLmtlZXBSdWJ5KVxuXHR7XG5cdFx0W1xuXHRcdFx0J3JwJyxcblx0XHRcdCdydCcsXG5cdFx0XHQncnVieScsXG5cdFx0XS5mb3JFYWNoKHRhZyA9PlxuXHRcdHtcblx0XHRcdF90YWdUb0Zvcm1hdChfdGFyZ2V0LCB0YWcsICQpXG5cdFx0fSlcblx0XHQ7XG5cdH1cblxuXHRpZiAob3B0aW9uc1J1bnRpbWUua2VlcEZvcm1hdClcblx0e1xuXHRcdFtcblx0XHRcdCdzJyxcblx0XHRcdCdpJyxcblx0XHRcdCdiJyxcblx0XHRcdCdzdXAnLFxuXHRcdFx0J3N1YicsXG5cdFx0XS5mb3JFYWNoKHRhZyA9PlxuXHRcdHtcblx0XHRcdF90YWdUb0Zvcm1hdChfdGFyZ2V0LCB0YWcsICQpXG5cdFx0fSlcblx0XHQ7XG5cdH1cblxuXHRyZXR1cm4gX3RhcmdldFxufVxuXG5leHBvcnQgZnVuY3Rpb24gX2tlZXBJbWFnZUluQ29udGV4dChfaW1nczogSlF1ZXJ5LCAkOiBKUXVlcnlTdGF0aWMsIHtcblx0cHJlZml4ID0gJ+aPkuWclicsXG5cdGFwcGVuZCA9ICcnLFxufSA9IHt9KVxue1xuXHRfaW1ncy5lYWNoKChpLCBlbGVtKSA9PiB7XG5cblx0XHRsZXQgaW1nID0gJChlbGVtKTtcblx0XHRsZXQgc3JjID0gaW1nLnByb3AoJ3NyYycpO1xuXG5cdFx0aW1nLmFmdGVyKGDvvIgke3ByZWZpeH0ke2hhc2hTdW0oc3JjKX3vvIkke2FwcGVuZH1gKTtcblx0XHRpbWcucmVtb3ZlKCk7XG5cblx0fSk7XG5cblx0cmV0dXJuIF9pbWdzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX3RhZ1RvRm9ybWF0KF90YXJnZXQ6IEpRdWVyeSwgdGFnOiBzdHJpbmcsICQ6IEpRdWVyeVN0YXRpYylcbntcblx0X3RhcmdldC5maW5kKHRhZylcblx0XHQuZWFjaCgoaSwgZWxlbSkgPT5cblx0XHR7XG5cdFx0XHRsZXQgX3RoaXMgPSAkKGVsZW0pO1xuXG5cdFx0XHRfdGhpcy5hZnRlcihg77ycJHt0YWd977yeJHtfdGhpcy5odG1sKCl977ycLyR7dGFnfe+8nmApO1xuXHRcdFx0X3RoaXMucmVtb3ZlKCk7XG5cblx0XHR9KVxuXHQ7XG5cblx0cmV0dXJuIF90YXJnZXQ7XG59XG4iXX0=