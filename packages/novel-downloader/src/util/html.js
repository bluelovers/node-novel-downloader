"use strict";
/// <reference types="jquery" />
Object.defineProperty(exports, "__esModule", { value: true });
const hash_1 = require("./hash");
function keepFormatTag(target, opts) {
    let { optionsRuntime, $ } = opts;
    let _target = $(target);
    if (optionsRuntime.keepRuby) {
        [
            'rp',
            'rt',
            'ruby',
        ].forEach(tag => {
            _tagToFormat(_target, tag, $);
        });
    }
    if (optionsRuntime.keepFormat) {
        [
            's',
            'i',
            'b',
            'sup',
            'sub',
        ].forEach(tag => {
            _tagToFormat(_target, tag, $);
        });
    }
    return _target;
}
exports.keepFormatTag = keepFormatTag;
function _keepImageInContext(_imgs, $, { prefix = '插圖', append = '', } = {}) {
    _imgs.each((i, elem) => {
        let img = $(elem);
        let src = img.prop('src');
        img.after(`（${prefix}${hash_1.hashSum(src)}）${append}`);
        img.remove();
    });
    return _imgs;
}
exports._keepImageInContext = _keepImageInContext;
function _tagToFormat(_target, tag, $) {
    _target.find(tag)
        .each((i, elem) => {
        let _this = $(elem);
        _this.after(`＜${tag}＞${_this.html()}＜/${tag}＞`);
        _this.remove();
    });
    return _target;
}
exports._tagToFormat = _tagToFormat;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHRtbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImh0bWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGdDQUFnQzs7QUFHaEMsaUNBQWlDO0FBRWpDLFNBQWdCLGFBQWEsQ0FBNEUsTUFBUyxFQUFFLElBR25IO0lBRUEsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7SUFFakMsSUFBSSxPQUFPLEdBQVcsQ0FBQyxDQUFDLE1BQXFCLENBQUMsQ0FBQztJQUUvQyxJQUFJLGNBQWMsQ0FBQyxRQUFRLEVBQzNCO1FBQ0M7WUFDQyxJQUFJO1lBQ0osSUFBSTtZQUNKLE1BQU07U0FDTixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUVmLFlBQVksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzlCLENBQUMsQ0FBQyxDQUNEO0tBQ0Q7SUFFRCxJQUFJLGNBQWMsQ0FBQyxVQUFVLEVBQzdCO1FBQ0M7WUFDQyxHQUFHO1lBQ0gsR0FBRztZQUNILEdBQUc7WUFDSCxLQUFLO1lBQ0wsS0FBSztTQUNMLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBRWYsWUFBWSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDOUIsQ0FBQyxDQUFDLENBQ0Q7S0FDRDtJQUVELE9BQU8sT0FBTyxDQUFBO0FBQ2YsQ0FBQztBQXRDRCxzQ0FzQ0M7QUFFRCxTQUFnQixtQkFBbUIsQ0FBQyxLQUFhLEVBQUUsQ0FBZSxFQUFFLEVBQ25FLE1BQU0sR0FBRyxJQUFJLEVBQ2IsTUFBTSxHQUFHLEVBQUUsR0FDWCxHQUFHLEVBQUU7SUFFTCxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFO1FBRXRCLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQixJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTFCLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLEdBQUcsY0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDakQsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBRWQsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLEtBQUssQ0FBQztBQUNkLENBQUM7QUFoQkQsa0RBZ0JDO0FBRUQsU0FBZ0IsWUFBWSxDQUFDLE9BQWUsRUFBRSxHQUFXLEVBQUUsQ0FBZTtJQUV6RSxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztTQUNmLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUVqQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFcEIsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNoRCxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7SUFFaEIsQ0FBQyxDQUFDLENBQ0Y7SUFFRCxPQUFPLE9BQU8sQ0FBQztBQUNoQixDQUFDO0FBZEQsb0NBY0MiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSB0eXBlcz1cImpxdWVyeVwiIC8+XG5cbmltcG9ydCBOb3ZlbFNpdGUgZnJvbSAnLi4vc2l0ZS9pbmRleCc7XG5pbXBvcnQgeyBoYXNoU3VtIH0gZnJvbSAnLi9oYXNoJztcblxuZXhwb3J0IGZ1bmN0aW9uIGtlZXBGb3JtYXRUYWc8TyA9IE5vdmVsU2l0ZS5JT3B0aW9uc1J1bnRpbWUsIEUgZXh0ZW5kcyB1bmtub3duIHwgSlF1ZXJ5U3RhdGljID0gdW5rbm93bj4odGFyZ2V0OiBFLCBvcHRzOiB7XG5cdCQ6IEpRdWVyeVN0YXRpYyxcblx0b3B0aW9uc1J1bnRpbWU6IE8gJiBOb3ZlbFNpdGUuSU9wdGlvbnNSdW50aW1lLFxufSlcbntcblx0bGV0IHsgb3B0aW9uc1J1bnRpbWUsICQgfSA9IG9wdHM7XG5cblx0bGV0IF90YXJnZXQ6IEpRdWVyeSA9ICQodGFyZ2V0IGFzIEhUTUxFbGVtZW50KTtcblxuXHRpZiAob3B0aW9uc1J1bnRpbWUua2VlcFJ1YnkpXG5cdHtcblx0XHRbXG5cdFx0XHQncnAnLFxuXHRcdFx0J3J0Jyxcblx0XHRcdCdydWJ5Jyxcblx0XHRdLmZvckVhY2godGFnID0+XG5cdFx0e1xuXHRcdFx0X3RhZ1RvRm9ybWF0KF90YXJnZXQsIHRhZywgJClcblx0XHR9KVxuXHRcdDtcblx0fVxuXG5cdGlmIChvcHRpb25zUnVudGltZS5rZWVwRm9ybWF0KVxuXHR7XG5cdFx0W1xuXHRcdFx0J3MnLFxuXHRcdFx0J2knLFxuXHRcdFx0J2InLFxuXHRcdFx0J3N1cCcsXG5cdFx0XHQnc3ViJyxcblx0XHRdLmZvckVhY2godGFnID0+XG5cdFx0e1xuXHRcdFx0X3RhZ1RvRm9ybWF0KF90YXJnZXQsIHRhZywgJClcblx0XHR9KVxuXHRcdDtcblx0fVxuXG5cdHJldHVybiBfdGFyZ2V0XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfa2VlcEltYWdlSW5Db250ZXh0KF9pbWdzOiBKUXVlcnksICQ6IEpRdWVyeVN0YXRpYywge1xuXHRwcmVmaXggPSAn5o+S5ZyWJyxcblx0YXBwZW5kID0gJycsXG59ID0ge30pXG57XG5cdF9pbWdzLmVhY2goKGksIGVsZW0pID0+IHtcblxuXHRcdGxldCBpbWcgPSAkKGVsZW0pO1xuXHRcdGxldCBzcmMgPSBpbWcucHJvcCgnc3JjJyk7XG5cblx0XHRpbWcuYWZ0ZXIoYO+8iCR7cHJlZml4fSR7aGFzaFN1bShzcmMpfe+8iSR7YXBwZW5kfWApO1xuXHRcdGltZy5yZW1vdmUoKTtcblxuXHR9KTtcblxuXHRyZXR1cm4gX2ltZ3M7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfdGFnVG9Gb3JtYXQoX3RhcmdldDogSlF1ZXJ5LCB0YWc6IHN0cmluZywgJDogSlF1ZXJ5U3RhdGljKVxue1xuXHRfdGFyZ2V0LmZpbmQodGFnKVxuXHRcdC5lYWNoKChpLCBlbGVtKSA9PlxuXHRcdHtcblx0XHRcdGxldCBfdGhpcyA9ICQoZWxlbSk7XG5cblx0XHRcdF90aGlzLmFmdGVyKGDvvJwke3RhZ33vvJ4ke190aGlzLmh0bWwoKX3vvJwvJHt0YWd977yeYCk7XG5cdFx0XHRfdGhpcy5yZW1vdmUoKTtcblxuXHRcdH0pXG5cdDtcblxuXHRyZXR1cm4gX3RhcmdldDtcbn1cbiJdfQ==